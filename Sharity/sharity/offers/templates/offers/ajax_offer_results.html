{% extends "offers/base.html" %}

{% block navbar %}

{% endblock navbar %}

{% block content %}
    <div class="result-container">

        <div class="d-flex justify-content-center">
            <div class="spinner-border" role="status" style="display: none;">
              <span class="sr-only">Loading...</span>
            </div>
        </div>

        {% if filter_flag %}
                <div class="applied-filters">
                    <h5 class="applied-filters-header"> <u> Applied filters </u> </h5>
                    {% if keyword_query %}
                        <b> Keyword: </b> {{keyword_query}} <span> <svg id="id-remove-filter-keyword" class="remove-filter" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                            <path d="M0 256C0 114.6 114.6 0 256 0C397.4 0 512 114.6 512 256C512 397.4 397.4 512 256 512C114.6 512 0 397.4 0 256zM175 208.1L222.1 255.1L175 303C165.7 312.4 165.7 327.6 175 336.1C184.4 346.3 199.6 346.3 208.1 336.1L255.1 289.9L303 336.1C312.4 346.3 327.6 346.3 336.1 336.1C346.3 327.6 346.3 312.4 336.1 303L289.9 255.1L336.1 208.1C346.3 199.6 346.3 184.4 336.1 175C327.6 165.7 312.4 165.7 303 175L255.1 222.1L208.1 175C199.6 165.7 184.4 165.7 175 175C165.7 184.4 165.7 199.6 175 208.1V208.1z"/></svg><br></span>
                    {% endif %}

                    {% if location_query %}
                        <b> Location: </b> {{location_query}} <span> <svg id="id-remove-filter-location" class="remove-filter" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                            <path d="M0 256C0 114.6 114.6 0 256 0C397.4 0 512 114.6 512 256C512 397.4 397.4 512 256 512C114.6 512 0 397.4 0 256zM175 208.1L222.1 255.1L175 303C165.7 312.4 165.7 327.6 175 336.1C184.4 346.3 199.6 346.3 208.1 336.1L255.1 289.9L303 336.1C312.4 346.3 327.6 346.3 336.1 336.1C346.3 327.6 346.3 312.4 336.1 303L289.9 255.1L336.1 208.1C346.3 199.6 346.3 184.4 336.1 175C327.6 165.7 312.4 165.7 303 175L255.1 222.1L208.1 175C199.6 165.7 184.4 165.7 175 175C165.7 184.4 165.7 199.6 175 208.1V208.1z"/></svg><br></span>
                    {% endif %}

                    {% if start_date_query %}
                        <b> Start date: </b> {{start_date_query}} <span> <svg id="id-remove-filter-start_date" class="remove-filter" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                            <path d="M0 256C0 114.6 114.6 0 256 0C397.4 0 512 114.6 512 256C512 397.4 397.4 512 256 512C114.6 512 0 397.4 0 256zM175 208.1L222.1 255.1L175 303C165.7 312.4 165.7 327.6 175 336.1C184.4 346.3 199.6 346.3 208.1 336.1L255.1 289.9L303 336.1C312.4 346.3 327.6 346.3 336.1 336.1C346.3 327.6 346.3 312.4 336.1 303L289.9 255.1L336.1 208.1C346.3 199.6 346.3 184.4 336.1 175C327.6 165.7 312.4 165.7 303 175L255.1 222.1L208.1 175C199.6 165.7 184.4 165.7 175 175C165.7 184.4 165.7 199.6 175 208.1V208.1z"/></svg><br></span>
                    {% endif %}

                    {% if duration_query %}
                        <b> Duration: </b> {{duration_query}} <span> <svg id="id-remove-filter-duration" class="remove-filter" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                            <path d="M0 256C0 114.6 114.6 0 256 0C397.4 0 512 114.6 512 256C512 397.4 397.4 512 256 512C114.6 512 0 397.4 0 256zM175 208.1L222.1 255.1L175 303C165.7 312.4 165.7 327.6 175 336.1C184.4 346.3 199.6 346.3 208.1 336.1L255.1 289.9L303 336.1C312.4 346.3 327.6 346.3 336.1 336.1C346.3 327.6 346.3 312.4 336.1 303L289.9 255.1L336.1 208.1C346.3 199.6 346.3 184.4 336.1 175C327.6 165.7 312.4 165.7 303 175L255.1 222.1L208.1 175C199.6 165.7 184.4 165.7 175 175C165.7 184.4 165.7 199.6 175 208.1V208.1z"/></svg><br></span>
                    {% endif %}

                    {% if tags_query %}
                        <b> Tags: </b> {{tags_query|join:', '}} <span> <svg id="id-remove-filter-tags" class="remove-filter" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                            <path d="M0 256C0 114.6 114.6 0 256 0C397.4 0 512 114.6 512 256C512 397.4 397.4 512 256 512C114.6 512 0 397.4 0 256zM175 208.1L222.1 255.1L175 303C165.7 312.4 165.7 327.6 175 336.1C184.4 346.3 199.6 346.3 208.1 336.1L255.1 289.9L303 336.1C312.4 346.3 327.6 346.3 336.1 336.1C346.3 327.6 346.3 312.4 336.1 303L289.9 255.1L336.1 208.1C346.3 199.6 346.3 184.4 336.1 175C327.6 165.7 312.4 165.7 303 175L255.1 222.1L208.1 175C199.6 165.7 184.4 165.7 175 175C165.7 184.4 165.7 199.6 175 208.1V208.1z"/></svg><br></span>
                    {% endif %}

                    {% if type_query %}
                        <b> Type: </b> {{type_query}} <span> <svg id="id-remove-filter-type" class="remove-filter" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                            <path d="M0 256C0 114.6 114.6 0 256 0C397.4 0 512 114.6 512 256C512 397.4 397.4 512 256 512C114.6 512 0 397.4 0 256zM175 208.1L222.1 255.1L175 303C165.7 312.4 165.7 327.6 175 336.1C184.4 346.3 199.6 346.3 208.1 336.1L255.1 289.9L303 336.1C312.4 346.3 327.6 346.3 336.1 336.1C346.3 327.6 346.3 312.4 336.1 303L289.9 255.1L336.1 208.1C346.3 199.6 346.3 184.4 336.1 175C327.6 165.7 312.4 165.7 303 175L255.1 222.1L208.1 175C199.6 165.7 184.4 165.7 175 175C165.7 184.4 165.7 199.6 175 208.1V208.1z"/></svg><br></span>
                    {% endif %}

                    {% if owner_query %}
                        <b> Owner: </b> {{owner_query}} <span> <svg id="id-remove-filter-owner" class="remove-filter" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                            <path d="M0 256C0 114.6 114.6 0 256 0C397.4 0 512 114.6 512 256C512 397.4 397.4 512 256 512C114.6 512 0 397.4 0 256zM175 208.1L222.1 255.1L175 303C165.7 312.4 165.7 327.6 175 336.1C184.4 346.3 199.6 346.3 208.1 336.1L255.1 289.9L303 336.1C312.4 346.3 327.6 346.3 336.1 336.1C346.3 327.6 346.3 312.4 336.1 303L289.9 255.1L336.1 208.1C346.3 199.6 346.3 184.4 336.1 175C327.6 165.7 312.4 165.7 303 175L255.1 222.1L208.1 175C199.6 165.7 184.4 165.7 175 175C165.7 184.4 165.7 199.6 175 208.1V208.1z"/></svg><br></span>
                    {% endif %}

                    {% if distance_query %}
                    <b> Distance: </b> {{distance_query}} KM <span> <svg id="id-remove-filter-distance" class="remove-filter" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                        <path d="M0 256C0 114.6 114.6 0 256 0C397.4 0 512 114.6 512 256C512 397.4 397.4 512 256 512C114.6 512 0 397.4 0 256zM175 208.1L222.1 255.1L175 303C165.7 312.4 165.7 327.6 175 336.1C184.4 346.3 199.6 346.3 208.1 336.1L255.1 289.9L303 336.1C312.4 346.3 327.6 346.3 336.1 336.1C346.3 327.6 346.3 312.4 336.1 303L289.9 255.1L336.1 208.1C346.3 199.6 346.3 184.4 336.1 175C327.6 165.7 312.4 165.7 303 175L255.1 222.1L208.1 175C199.6 165.7 184.4 165.7 175 175C165.7 184.4 165.7 199.6 175 208.1V208.1z"/></svg><br></span>
                    {% endif %}
                </div>
            {% endif %}
    </div>

    <div>
        <h2>Found Offers</h2>
        <p> {{result_list|length}} result(s) found </p>
        <div class="row">
            {% for result in result_list %}

                <div class="col-sm-6">
                    <div class="card">
                        {% if result.photo %} <img src="{{result.photo.url}}" class="card-img-top" alt="..."> {% endif %}
                        <div class="card-body">
                            <h5 id="id-card-title-{{result.pk}}" class="card-title"> {{result.title}} </h5>
                            {% if result.description %} <p class="card-text"><b> Description: </b> {{ result.description|truncatewords_html:6 }} </p> {% endif %}
                            <p class="card-text"> <b> Start date: </b> {{result.start_date}} </p>
                            <p class="card-text"> <b> Duration: </b> {{result.duration}} </p>
                            <p class="card-text"> <b> Type: </b> {{result.get_type}} </p>
                            <p class="card-text"> <b> Tags: </b> {{result.get_tag_labels|join:", "}} </p>
                            <p class="card-text"> <b> Location: </b> {{result.get_formatted_address}} </p>
                            <p class="card-text"> <b> Owner: </b> <a class="text-decoration-none" href="{% url 'profile' result.owner %}">@{{ result.owner }}</a>
                                {% if result.owner.Nbadge.is_active %} <span class="badge rounded-pill bg-primary" data-value="This badge belongs to users who havenâ€™t finished their one month in the community">Newcomer</span> {% endif %}
                                {% if result.owner.CBbadge.is_active %} <span class="badge rounded-pill bg-info text-dark" data-value="This badge belongs to users who take at least 5 offers from newcomers in a month">Community Builder</span> {% endif %}
                                {% if result.owner.GSPbadge.is_active %} <span class="badge rounded-pill bg-secondary" data-value="This badge belongs to users who have offered 10 or more services in a month while having 4+ ratings">Great Service Provider</span> {% endif %}
                                {% if result.owner.MEObadge.is_active %} <span class="badge rounded-pill bg-success" data-value="This badge belongs to users who have offered 10 or more events in a month">Master Event Organizer</span> {% endif %}
                            </p>
                            <a href="{% url 'offers.detail' pk=result.pk %}" class="btn btn-primary">Go to Offer</a>
                            <a href="{% url 'offers.apply' sID=result.uuid %}" class="btn btn-primary">Apply to Offer</a>
                            <a id="id_send_message_from_explore_{{result.pk}}" href="{% url 'usermessages.create' %}" class="btn btn-primary">Message to {{result.owner}}</a>
                        </div>
                    </div>
                </div>
            {% empty %}
            {% endfor %}
        </div>
    </div>

{% endblock content %}

{% block js %}
    <script>
        $(".rounded-pill").hover(function () {
            $(this).popover({
                content: $(this).data('value')
            }).popover('show');
        }, function () {
            $(this).popover('hide');
        });
    </script>
{% endblock js %}

{% block styles %}
    <style>
        .remove-filter {
            width: 15px;
            height: 15px;
            margin-bottom: 1px;
        }

        .remove-filter:hover {
            width: 17px;
            height: 17px;
        }

    </style>
    
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>

{% endblock styles %}